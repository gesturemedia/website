(()=>{var e={991:e=>{(()=>{"use strict";var t,a={};t=a,Object.defineProperty(t,"__esModule",{value:!0}),t.SHOPIFY_API_KEY=t.DEVELOPMENT_PATH_PREFIX=t.GEOSERVICE_URL=t.APP_URL=t.NODE_ENV=void 0,t.NODE_ENV="production",t.APP_URL="https://skosm.klarna.com",t.GEOSERVICE_URL=`${t.APP_URL}/geolocation/v1`,t.DEVELOPMENT_PATH_PREFIX="",t.SHOPIFY_API_KEY="4439684aa13a71f0befb66b3a308e7d4",e.exports=a})()}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}(()=>{"use strict";let e=null;const t="shopify_osm_debug_log",n=(...a)=>{var n,i;null===e&&(e="true"===(null===(n=localStorage.getItem(t))||void 0===n?void 0:n.toLowerCase())||"true"===(null===(i=new URLSearchParams(window.location.search).get("consoleDebug"))||void 0===i?void 0:i.toLowerCase()),e?localStorage.setItem(t,String(e)):localStorage.removeItem(t)),e&&console.log("[klarna-osm]",...a)},i=e=>new Promise((t=>setTimeout(t,e)));var r=a(991);const o={"Europe/Vienna":"AT","Australia/Lord_Howe":"AU","Antarctica/Macquarie":"AU","Australia/Hobart":"AU","Australia/Currie":"AU","Australia/Melbourne":"AU","Australia/Sydney":"AU","Australia/Broken_Hill":"AU","Australia/Brisbane":"AU","Australia/Lindeman":"AU","Australia/Adelaide":"AU","Australia/Darwin":"AU","Australia/Perth":"AU","Australia/Eucla":"AU","Europe/Brussels":"BE","America/St_Johns":"CA","America/Halifax":"CA","America/Glace_Bay":"CA","America/Moncton":"CA","America/Goose_Bay":"CA","America/Blanc-Sablon":"CA","America/Toronto":"CA","America/Nipigon":"CA","America/Thunder_Bay":"CA","America/Iqaluit":"CA","America/Pangnirtung":"CA","America/Resolute":"CA","America/Atikokan":"CA","America/Rankin_Inlet":"CA","America/Winnipeg":"CA","America/Rainy_River":"CA","America/Regina":"CA","America/Swift_Current":"CA","America/Edmonton":"CA","America/Cambridge_Bay":"CA","America/Yellowknife":"CA","America/Inuvik":"CA","America/Creston":"CA","America/Dawson_Creek":"CA","America/Vancouver":"CA","America/Whitehorse":"CA","America/Dawson":"CA","Europe/Zurich":"CH","Europe/Prague":"CZ","Europe/Berlin":"DE","Europe/Busingen":"DE","Europe/Copenhagen":"DK","Europe/Madrid":"ES","Africa/Ceuta":"ES","Atlantic/Canary":"ES","Europe/Helsinki":"FI","Europe/Paris":"FR","Europe/Budapest":"HU","Europe/Rome":"IT","America/Mexico_City":"MX","America/Cancun":"MX","America/Merida":"MX","America/Monterrey":"MX","America/Matamoros":"MX","America/Mazatlan":"MX","America/Chihuahua":"MX","America/Ojinaga":"MX","America/Hermosillo":"MX","America/Tijuana":"MX","America/Santa_Isabel":"MX","America/Bahia_Banderas":"MX","Europe/Amsterdam":"NL","Arctic/Longyearbyen":"NO","Europe/Oslo":"NO","Europe/Warsaw":"PL","Europe/Lisbon":"PT","Atlantic/Madeira":"PT","Atlantic/Azores":"PT","Europe/Stockholm":"SE","Europe/Bratislava":"SK"},s="klarnaosm_user_locale";class l{constructor(e){this.midLocales=e}static getCountryFromTimeZone(){var e;const{timeZone:t}=Intl.DateTimeFormat().resolvedOptions(),a=null!==(e=o[t])&&void 0!==e?e:null;return a||n("[getCountryFromTimeZone] unsupported country or time zone",{timeZone:t}),a}static async getUsersCountry(){let e=l.getCachedUsersCountry();if(e)return n("Found users country in cache"),e;try{const t=new AbortController;setTimeout((()=>t.abort()),1500);const a=await fetch(r.GEOSERVICE_URL,{signal:t.signal});if(!a.ok)throw new Error(a.statusText);e=(await a.json()).country}catch(e){return n("[getUsersCountry] Failed",e),n("[getUsersCountry] trying to parse from time zone"),this.getCountryFromTimeZone()}return e&&l.setCachedUsersCountry(e),e}static getCachedUsersCountry(){return localStorage.getItem(s)||null}static setCachedUsersCountry(e){n("Setting users country to cache",e),localStorage.setItem(s,e)}static findLocale(e,t,a){var i,r;if(e){n("[getMatchingLocale] Valid locales for users country",e);const o=null!==(i=e[0])&&void 0!==i?i:null;let s="";if(t&&"undefined"!=typeof Shopify?(s=Shopify.locale,n("[getMatchingLocale] Using Shopify.locale",s)):navigator.language&&(s=navigator.language.slice(0,2),n("[getMatchingLocale] Using browser language",s)),s){const t=e.find((e=>e.startsWith(s)));if(t)return t}return a&&null!==(r=e.find((e=>e.startsWith("en"))))&&void 0!==r?r:o}return null}getMatchingLocale(e,t,a){if(!e||!this.midLocales)return n("[getMatchingLocale] Invalid data",e,this.midLocales),null;n("[getMatchingLocale] Available countries for merchant",a);const i=this.getFilteredLocales(a);n("[getMatchingLocale] Valid locales for merchant",i);const r=null==i?void 0:i[e];return l.findLocale(r,t,!0)}getFilteredLocales(e){if(!e)return this.midLocales;const t=new Set(e);return Object.keys(this.midLocales).reduce(((e,a)=>(t.has(a)&&(e[a]=this.midLocales[a]),e)),{})}getMatchingLocaleWithMidLocales(e,t){if(!e||!this.midLocales||0===Object.keys(this.midLocales).length)return n("[getMatchingLocale] Invalid data",e,this.midLocales),null;const a=this.midLocales[e];return l.findLocale(a,t,!1)}}const c=l;class u{constructor(e,t){this.store=e,this.productVariants=t,this.conflictingAppIds=[],this.eventHandler=()=>{this.updatePlacements()},this.localeService=new c(e.mid_locales)}static getVariantIdFromQueryString(){const e=new URLSearchParams(window.location.search).get("variant");return e?Number.parseInt(e,10):null}async init(){var e;window.klarna_OSMP=window.klarna_OSMP||{},window.klarna_OSMP.updaterId=null!==(e=window.klarna_OSMP.updaterId)&&void 0!==e?e:0,window.klarna_OSMP.rerenders=new Array(this.calculateRerendersLenBasedOnPlacementsCount()),this.conflictingAppIds=["tmenu-app"].filter((e=>!!document.getElementById(e))),this.logIfConflictingAppsDetected(),this.injectOnSiteScripts(),await this.initPurchaseAmountIfCartOrProductPage(),this.listenForInputChange()}calculateRerendersLenBasedOnPlacementsCount(){var e,t,a;return 5+2*(null!==(a=null===(t=null===(e=window.klarna_OSMP)||void 0===e?void 0:e.placements)||void 0===t?void 0:t.filter((e=>e.placement_page===this.currentPageType)).length)&&void 0!==a?a:0)}logIfConflictingAppsDetected(){this.conflictingAppIds.length>0&&n(`Detected apps conflicting with Klarna placements: ${this.conflictingAppIds.join(", ")}. It may cause unwanted behaviour.`)}injectOnSiteScripts(){if(null!==document.getElementById("klarna-osm-script-tag"))return;const e="us"===this.store.endpoint?"na":this.store.endpoint;let t;t=this.store.playground_active?`https://${e}-library.playground.klarnaservices.com`:`https://${e}-library.klarnaservices.com`;try{const e=document.createElement("script");e.id="klarna-osm-script-tag",e.async=!0,e.src=`${t}/lib.js`,e.setAttribute("data-client-id",this.store.client_id);const a=document.querySelector("body");a.insertBefore(e,a.children[0])}catch(e){n("Could not add script element",e)}}async initPurchaseAmountIfCartOrProductPage(){["cart","product"].includes(this.currentPageType)&&await this.updatePurchaseAmount()}listenForInputChange(){"cart"===this.currentPageType&&(0!==this.conflictingAppIds.length?this.updatePlacementsOnInputEvents():this.updatePlacementsOnDomMutations()),"product"===this.currentPageType&&new MutationObserver((e=>{this.getKlarnaPlacements().forEach((e=>{var t,a;const i=String(this.getDataPurchaseAmount()||0),r=e.getAttribute("data-purchase-amount");i!==e.getAttribute("data-purchase-amount")&&(n(`amount changed to ${i} from ${r}`),e.setAttribute("data-purchase-amount",i),(null===(a=null===(t=window.Klarna)||void 0===t?void 0:t.OnsiteMessaging)||void 0===a?void 0:a.refresh)?window.Klarna.OnsiteMessaging.refresh():window.KlarnaOnsiteService.push({eventName:"refresh-placements"}))}))})).observe(document.body,{childList:!0,subtree:!0})}updatePlacementsOnDomMutations(){const e=new MutationObserver((async t=>{window.klarna_OSMP.updaterId+=1;const a=window.klarna_OSMP.updaterId,r=[void 0,void 0,await this.getCartTotal()];let o=5;if(u.addCurrentTimeToRerenders(),u.calculateMaxTimeBetweenRerenders()<1e3)return n("Detected too frequent placement rerenders based on DOM modifications. Switching logic to input related one."),o=-1,e.disconnect(),void this.updatePlacementsOnInputEvents();const s=async()=>{const e=await this.getCartTotal();return n("Comparing amount and history",e,r),!!r.some((t=>t!==e))&&(this.updatePurchaseAmount(e),r.shift(),r.push(e),!0)};for(;o>0&&a===window.klarna_OSMP.updaterId;)o-=1,await i(1e3),await s()}));e.observe(document.body,{childList:!0,subtree:!0})}static addCurrentTimeToRerenders(){const{rerenders:e}=window.klarna_OSMP;e.shift(),e.push(new Date)}static calculateMaxTimeBetweenRerenders(){var e,t;const{rerenders:a}=window.klarna_OSMP;return((null===(e=a[a.length-1])||void 0===e?void 0:e.getTime())||1/0)-((null===(t=a[0])||void 0===t?void 0:t.getTime())||-1/0)}updatePlacementsOnInputEvents(){document.querySelectorAll("select, input").forEach((e=>{e.removeEventListener("change",this.eventHandler,!0),e.addEventListener("change",this.eventHandler,!0)}))}async updatePlacements(){await i(20),window.klarna_OSMP.updaterId+=1;const e=window.klarna_OSMP.updaterId;n("Updater started with id",e);let t=await this.getCartTotal();const a=async e=>{await i(e);const a=await this.getCartTotal();return a!==t&&(this.updatePurchaseAmount(a),t=a,!0)};for(;;){let t=10,i=50;for(;t&&!(e<window.klarna_OSMP.updaterId)&&!await a(i);)i*=1.5,t-=1;if(e<window.klarna_OSMP.updaterId){n("Updater terminated due to new one running",e);break}if(!await a(1e3))break}this.updatePlacementsOnInputEvents()}async updatePurchaseAmount(e=""){var t,a;const i=this.getKlarnaPlacements();let r=e;r||("cart"===this.currentPageType?r=await this.getCartTotal():"product"===this.currentPageType&&(r=this.getDataPurchaseAmount())),n("Updating purchase amount",r),i.forEach((e=>{n("updating placement",e),e.setAttribute("data-purchase-amount",String(r))})),(null===(a=null===(t=window.Klarna)||void 0===t?void 0:t.OnsiteMessaging)||void 0===a?void 0:a.refresh)?window.Klarna.OnsiteMessaging.refresh():window.KlarnaOnsiteService.push({eventName:"refresh-placements"}),0!==this.conflictingAppIds.length&&this.listenForInputChange()}async getCartTotal(){const e=await fetch("/cart.json");if(!e.ok)throw new Error;const t=await e.json();return t.total_price?t.total_price:0}}class d extends u{constructor(e,t){super(e,t.productVariants),this.data=t,this.currentPageType=t.templateName}async init(){var e,t;const a=this.getKlarnaPlacement();a.setAttribute("data-locale",await this.fetchLocale()),a.setAttribute("data-purchase-amount",this.getPurchaseAmount()),"product"===this.currentPageType&&"0"===this.getPurchaseAmount()&&(null===(e=this.store.dynamic_placements)||void 0===e?void 0:e.includes(a.getAttribute("data-key")||""))&&(n("[AppBlocksInject] using fallback placement",this.store.fallback_placement),a.setAttribute("data-key",this.store.fallback_placement)),a.setAttribute("data-preloaded","true");const i=Number.isNaN(this.data.topPadding)?0:this.data.topPadding,r=Number.isNaN(this.data.bottomPadding)?0:this.data.bottomPadding;return(i>0||r>0)&&(null===(t=document.getElementById(`shopify-block-${this.data.selector.slice(12)}`))||void 0===t||t.setAttribute("style",`padding: ${i}px 0px ${r}px 0px;`)),super.init()}getPurchaseAmount(){var e;return"product"===this.currentPageType?this.data.variantPrice:"cart"===this.currentPageType?this.data.cartPrice:(null===(e=window.Shopify)||void 0===e?void 0:e.designMode)?"10998":"0"}async fetchLocale(){var e,t,a,i,r;if((null===(e=window.Shopify)||void 0===e?void 0:e.designMode)&&this.data.localeFallback)return this.data.localeFallback.trim();if("manual"===this.data.localeOption&&this.data.localeFallback)return n("[fetchLocale] using manual locale"),this.data.localeFallback.trim();if("geolocation"===this.data.localeOption){n("[fetchLocale] using geolocation");const e=await c.getUsersCountry(),t=this.localeService.getMatchingLocaleWithMidLocales(e,!0);return n("got matching locale",{usersCountry:e,matchingLocale:t,midLocales:this.store.mid_locales}),t}if(null===(t=window.Shopify)||void 0===t?void 0:t.designMode){const e=null===(a=this.store.mid_locales)||void 0===a?void 0:a[null===Shopify||void 0===Shopify?void 0:Shopify.country],t=e?[e]:Object.values(this.store.mid_locales);let o=null!==(r=null===(i=t[0])||void 0===i?void 0:i[0])&&void 0!==r?r:null;for(const e of t)for(const t of e)if(t.startsWith(this.data.shopLocale)){n("[fetchLocale] using locale for design mode",{locale:t,midLocales:this.store.mid_locales}),o=t;break}return o}return null}getDataPurchaseAmount(){var e,t,a,n,i,r,o,s;let l=null;const c=u.getVariantIdFromQueryString();return c&&(l=null===(e=this.productVariants)||void 0===e?void 0:e.find((e=>e.id===c))),l?l.price:null!==(s=null!==(i=null===(n=null===(a=null===(t=this.productVariants)||void 0===t?void 0:t.filter((e=>e.available)))||void 0===a?void 0:a[0])||void 0===n?void 0:n.price)&&void 0!==i?i:null===(o=null===(r=this.productVariants)||void 0===r?void 0:r[0])||void 0===o?void 0:o.price)&&void 0!==s?s:0}getKlarnaPlacement(){return document.getElementById(this.data.selector)}getKlarnaPlacements(){return[this.getKlarnaPlacement()]}}class h{constructor(e){this.storage=e,this.started=!1}static async fetchStore(){var e;if(this.store)return this.store;const t=new URL(("/app-blocks/v1/store",`${r.DEVELOPMENT_PATH_PREFIX}/app-blocks/v1/store`),r.APP_URL);t.searchParams.set("domain",null===(e=window.Shopify)||void 0===e?void 0:e.shop);const a=await fetch(t.toString());return this.store=await a.json(),this.store}static from(e){return e instanceof h?e:new h(null!=e?e:[])}async push(e){var t,a;await new d(await h.fetchStore(),e).init(),(null===(a=null===(t=window.Klarna)||void 0===t?void 0:t.OnsiteMessaging)||void 0===a?void 0:a.refresh)?window.Klarna.OnsiteMessaging.refresh():window.KlarnaOnsiteService.push({eventName:"refresh-placements"})}async start(){if(!this.started){this.started=!0;for(let e=this.storage.pop();void 0!==e;e=this.storage.pop())await this.push(e)}}}var m;n("app blocks loaded"),null!==(m=window.KlarnaOnsiteService)&&void 0!==m||(window.KlarnaOnsiteService=[]),window.Klarna=window.Klarna||{},window.klarnaAppBlocksManager=h.from(window.klarnaAppBlocksManager),window.klarnaAppBlocksManager.start()})()})();